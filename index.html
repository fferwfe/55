<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV äººç”Ÿå±¥æ­· - çµ‚æ¥µè³‡æºé…å°ç‰ˆ</title>
    <style>
        :root { --main: #2c3e50; --accent: #e67e22; --bg: #f5f7fa; --green: #27ae60; --red: #e74c3c; --white: #ffffff; --blue: #3498db; --gold: #f1c40f; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; }
        .header-info { display: flex; justify-content: space-between; background: var(--main); color: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-weight: bold; }
        .panel { background: var(--white); padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .player-card { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
        .rule-box { background: #fffde7; border: 1px solid var(--gold); padding: 10px; border-radius: 8px; font-size: 13px; color: #555; margin-top: 8px; font-weight: bold; }
        
        .dice-display { display: flex; justify-content: center; gap: 6px; margin: 10px 0; min-height: 55px; }
        .dice { width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.75rem; }
        .res-summary { text-align:center; font-weight:bold; margin: 8px 0; color: var(--main); background: #edf2f7; padding: 8px; border-radius: 5px; }
        
        .market { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { border: 2px solid #eee; padding: 10px; border-radius: 12px; text-align: center; display: flex; flex-direction: column; justify-content: space-between; min-height: 160px; transition: 0.3s; }
        .cost-area { background: #fff5f5; border-radius: 5px; padding: 4px; margin-bottom: 5px; border: 1px solid #fed7d7; }
        .gain-area { background: #f0fff4; border-radius: 5px; padding: 4px; border: 1px solid #c6f6d5; }
        .res-tag { display: inline-block; font-size: 10px; padding: 1px 4px; border-radius: 3px; margin: 1px; color: white; }
        
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .btn { border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; font-size: 16px; }
        .btn-roll { background: var(--accent); }
        .btn-end { background: var(--main); }
        .btn-buy { background: var(--green); margin-top: 5px; font-size: 12px; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        #msg-box { color: var(--red); font-weight: bold; text-align: center; height: 20px; font-size: 14px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div id="msg-box"></div>
    
    <div class="header-info">
        <span>ğŸ“… ç¬¬ <span id="round-num">1</span> / 5 å›åˆ</span>
        <span>ğŸ‘¤ ç©å®¶ <span id="player-label">1</span> / 10</span>
    </div>

    <div id="panel-main" class="panel">
        <div class="player-card">
            <h2 id="display-job" style="margin:0; color:var(--main);">--</h2>
            <div id="display-rule" class="rule-box">--</div>
            <div style="margin-top:10px; font-size: 12px;">æˆ‘çš„ç´¯ç©æ¨™ç±¤ï¼š<span id="my-tags" style="color:var(--blue); font-weight:bold;">ç„¡</span></div>
        </div>

        <div class="controls">
            <button id="roll-btn" class="btn btn-roll" onclick="rollDice()">ğŸ² æ“²éª°å­</button>
            <button id="end-btn" class="btn btn-end" onclick="nextPlayer()" disabled>ğŸ çµæŸå›åˆ</button>
        </div>

        <div class="dice-display" id="dice-container"></div>
        <div id="res-list" class="res-summary">è«‹å…ˆæ“²éª°å­ç²å–è³‡æº</div>

        <h3 style="font-size: 14px; border-left: 5px solid var(--blue); padding-left: 10px;">äººç”Ÿäº¤æ˜“æ‰€</h3>
        <div class="market" id="market-container"></div>
    </div>

    <div id="panel-over" class="panel" style="display:none; text-align: center;">
        <h1 style="color:var(--gold)">ğŸ† æˆå°±çµç®—</h1>
        <div id="final-list"></div>
        <button onclick="location.reload()" class="btn btn-roll" style="width:100%; margin-top:20px;">å†æ´»ä¸€æ¬¡</button>
    </div>
</div>

<script>
    const resColor = { 'é‡‘éŒ¢': '#f1c40f', 'æ™ºæ…§': '#3498db', 'äººéš›': '#e67e22', 'å¥åº·': '#9b59b6', 'ç¬‘è‡‰': '#2ecc71' };
    
    // æ‰€æœ‰çš„äº¤æ›éƒ½æ˜¯ 1æ›2, 2æ›1 æˆ– 2æ›3ï¼Œå®Œå…¨ä¸å°ç­‰
    const marketItems = [
        { n: 'è·¨åœ‹å¯¦ç¿’', cost: { 'æ™ºæ…§':1, 'äººéš›':1 }, gains: { 'é‡‘éŒ¢':2, 'æ™ºæ…§':1 } },
        { n: 'èº«å¿ƒä¿®è¡Œ', cost: { 'é‡‘éŒ¢':1 }, gains: { 'å¥åº·':1, 'æ™ºæ…§':1 } },
        { n: 'é¦¬æ‹‰æ¾è¨“ç·´', cost: { 'å¥åº·':2 }, gains: { 'å¥åº·':1, 'äººéš›':2 } },
        { n: 'ç¶²ç´…ç¶“ç‡Ÿ', cost: { 'äººéš›':2 }, gains: { 'é‡‘éŒ¢':2, 'æ™ºæ…§':1 } },
        { n: 'å°ˆåˆ©ç ”ç™¼', cost: { 'æ™ºæ…§':2 }, gains: { 'é‡‘éŒ¢':1, 'æ™ºæ…§':2 } },
        { n: 'ç¤¾äº¤èšæœƒ', cost: { 'é‡‘éŒ¢':1 }, gains: { 'äººéš›':2 } }
    ];

    const scoringRules = [
        { desc: "ğŸ’¡æ™ºæ…§ + ğŸ’°é‡‘éŒ¢ é…å° = 3åˆ†", pair: ['æ™ºæ…§', 'é‡‘éŒ¢'] },
        { desc: "ğŸ¤äººéš› + ğŸ’°é‡‘éŒ¢ é…å° = 3åˆ†", pair: ['äººéš›', 'é‡‘éŒ¢'] },
        { desc: "ğŸ¥å¥åº· + ğŸ¤äººéš› é…å° = 3åˆ†", pair: ['å¥åº·', 'äººéš›'] },
        { desc: "ğŸ’¡æ™ºæ…§ + ğŸ¥å¥åº· é…å° = 3åˆ†", pair: ['æ™ºæ…§', 'å¥åº·'] }
    ];

    let players = [], curIdx = 0, curRound = 1, turnRes = {}, hasRolled = false;

    function initGame() {
        players = Array.from({length:10}, (_, i) => ({
            id: i+1, job: ["é†«ç”Ÿ","ç¨‹å¼å“¡","ç•«å®¶","ä½œå®¶","å»šå¸«","æ©Ÿå¸«","è¾²å¤«","è©©äºº","å°éŠ","å¤ªç©ºäºº"][i],
            allTags: { 'é‡‘éŒ¢':0, 'æ™ºæ…§':0, 'äººéš›':0, 'å¥åº·':0 },
            rule: scoringRules[Math.floor(Math.random() * scoringRules.length)]
        }));
        updateUI();
    }

    function updateUI() {
        const p = players[curIdx];
        document.getElementById('player-label').innerText = curIdx + 1;
        document.getElementById('round-num').innerText = curRound;
        document.getElementById('display-job').innerText = p.job;
        document.getElementById('display-rule').innerText = "åŠ æˆï¼š" + p.rule.desc;
        let t = p.allTags;
        let tagTxt = Object.entries(t).filter(([k,v])=>v>0).map(([k,v])=>`${k}x${v}`).join(' / ');
        document.getElementById('my-tags').innerText = tagTxt || "æš«ç„¡æ¨™ç±¤";
        renderMarket();
    }

    function renderMarket() {
        document.getElementById('market-container').innerHTML = marketItems.map((c, idx) => {
            let costH = Object.entries(c.cost).map(([k,v])=>`<span class="res-tag" style="background:${resColor[k]}">${k}x${v}</span>`).join('');
            let gainH = Object.entries(c.gains).map(([k,v])=>`<span class="res-tag" style="background:${resColor[k]}">${k}x${v}</span>`).join('');
            return `<div class="card"><b style="font-size:13px;">${c.n}</b>
                <div class="cost-area">${costH}</div><div class="gain-area">${gainH}</div>
                <button class="btn btn-buy" onclick="buyCard(${idx})" ${!hasRolled?'disabled':''}>ç¢ºèªäº¤æ›</button></div>`;
        }).join('');
    }

    function rollDice() {
        turnRes = { 'é‡‘éŒ¢':0, 'æ™ºæ…§':0, 'äººéš›':0, 'å¥åº·':0, 'ç¬‘è‡‰':0 };
        let diceHtml = "";
        for(let i=0; i<4; i++) {
            let r = Object.keys(resColor)[Math.floor(Math.random()*5)];
            turnRes[r]++;
            diceHtml += `<div class="dice" style="background:${resColor[r]}">${r === 'ç¬‘è‡‰' ? 'ğŸ˜Š' : r}</div>`;
        }
        document.getElementById('dice-container').innerHTML = diceHtml;
        hasRolled = true;
        document.getElementById('roll-btn').disabled = true;
        document.getElementById('end-btn').disabled = false;
        renderTurnRes();
        renderMarket();
    }

    function buyCard(idx) {
        const c = marketItems[idx], p = players[curIdx];
        let tempSmile = turnRes['ç¬‘è‡‰'], canAfford = true;

        for (let [res, amt] of Object.entries(c.cost)) {
            let gap = amt - turnRes[res];
            if (gap > 0) {
                if (tempSmile >= gap) tempSmile -= gap;
                else { canAfford = false; break; }
            }
        }

        if (canAfford) {
            for (let [res, amt] of Object.entries(c.cost)) {
                let gap = amt - turnRes[res];
                if (gap > 0) { turnRes['ç¬‘è‡‰'] -= gap; turnRes[res] = 0; }
                else { turnRes[res] -= amt; }
            }
            for (let [res, amt] of Object.entries(c.gains)) { p.allTags[res] += amt; }
            document.getElementById('msg-box').innerText = "";
            renderTurnRes();
            updateUI();
        } else {
            document.getElementById('msg-box').innerText = "âŒ è³‡æºä¸è¶³ä»¥äº¤æ› " + c.n;
            setTimeout(()=> { document.getElementById('msg-box').innerText = ""; }, 2000);
        }
    }

    function renderTurnRes() {
        let txt = Object.entries(turnRes).filter(([k,v])=>v>0).map(([k,v])=>`${k}x${v}`).join(' / ');
        document.getElementById('res-list').innerText = "ç•¶å‰å‰©é¤˜ï¼š" + (txt || "å·²ç„¡è³‡æº");
    }

    function nextPlayer() {
        curIdx++;
        if(curIdx >= 10) { curIdx = 0; curRound++; if(curRound > 5) return endGame(); }
        hasRolled = false;
        document.getElementById('roll-btn').disabled = false;
        document.getElementById('end-btn').disabled = true;
        document.getElementById('dice-container').innerHTML = "";
        document.getElementById('res-list').innerText = "ç­‰å¾…æ“²éª°å­...";
        document.getElementById('msg-box').innerText = "";
        updateUI();
    }

    function endGame() {
        document.getElementById('panel-main').style.display = 'none';
        document.getElementById('panel-over').style.display = 'block';
        let results = players.map(p => {
            let t = {...p.allTags}, [r1, r2] = p.rule.pair;
            let pairs = Math.min(t[r1], t[r2]);
            let totalScore = (pairs * 3) + (Object.values(t).reduce((a,b)=>a+b, 0) - (pairs * 2));
            return { job: p.job, score: totalScore, tags: p.allTags, rule: p.rule.desc };
        }).sort((a,b) => b.score - a.score);

        document.getElementById('final-list').innerHTML = results.map((r, i) => `
            <div style="padding:12px; border-bottom:1px solid #eee; text-align:left;">
                <b>${i+1}. ${r.job}</b> <small>(${r.rule})</small><br>
                <small>ğŸ’°${r.tags['é‡‘éŒ¢']} ğŸ’¡${r.tags['æ™ºæ…§']} ğŸ¤${r.tags['äººéš›']} ğŸ¥${r.tags['å¥åº·']}</small>
                <div style="color:var(--red); font-weight:bold; font-size:1.2rem;">åƒ¹å€¼ï¼š${r.score} åˆ†</div>
            </div>`).join('');
    }
    initGame();
</script>
</body>
</html>
