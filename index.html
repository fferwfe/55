<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV äººç”Ÿå±¥æ­· - æ•¸å€¼ä¿®æ­£ç‰ˆ</title>
    <style>
        :root { --main: #2c3e50; --accent: #e67e22; --bg: #f5f7fa; --green: #27ae60; --red: #e74c3c; --gold: #f1c40f; --white: #ffffff; --blue: #3498db; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; }
        .header-info { display: flex; justify-content: space-between; background: var(--main); color: white; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-weight: bold; font-size: 14px; }
        .panel { background: var(--white); padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .player-card { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
        .secret-area { background: #f8f9fa; padding: 10px; border-radius: 10px; margin: 10px 0; border: 2px dashed #cbd5e0; }
        .secret-text { display: none; color: var(--red); font-weight: bold; font-size: 1.2rem; }
        .dice-display { display: flex; justify-content: center; gap: 6px; margin: 10px 0; min-height: 60px; }
        .dice { width: 55px; height: 55px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.65rem; }
        .res-summary { text-align:center; font-weight:bold; margin: 8px 0; color: var(--main); background: #edf2f7; padding: 8px; border-radius: 5px; }
        .market { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { border: 2px solid #eee; padding: 10px; border-radius: 12px; text-align: center; position: relative; min-height: 115px; display: flex; flex-direction: column; justify-content: space-between; }
        .card.match-highlight { border: 3px solid var(--gold); background: #fffde7; }
        .card.locked { opacity: 0.2; filter: grayscale(1); pointer-events: none; }
        .card.special-deal { border: 3px solid var(--green); background: #e8f5e9; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); } 100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); } }
        .score-tag { font-weight: bold; color: var(--red); font-size: 1.2rem; }
        .btn-buy { background: var(--green); color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; }
        .btn-roll { background: var(--accent); color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #event-banner { display: none; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-weight: bold; text-align: center; font-size: 14px; }
        .event-good { background: #e3f2fd; color: #1565c0; border: 2px solid #2196f3; }
        .event-bad { background: #ffebee; color: #c62828; border: 2px solid #ef5350; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-info">
        <span>ğŸ“… ç¬¬ <span id="round-num">1</span> / 5 å›åˆ</span>
        <span>ğŸ‘¤ ç©å®¶ <span id="player-label">1</span> / 10</span>
    </div>

    <div id="panel-main" class="panel">
        <div id="event-banner"></div>
        <div class="player-card">
            <h2 id="display-job" style="margin:0; color:var(--main);">--</h2>
            <div class="secret-area">
                <button onmousedown="showSecret(true)" onmouseup="showSecret(false)" ontouchstart="showSecret(true)" ontouchend="showSecret(false)" style="cursor:pointer; padding:6px 15px; border-radius:5px; border:1px solid #ccc; background: white;">ğŸ” æŒ‰ä½æŸ¥çœ‹éš±è—æ™‚æœŸ</button>
                <div id="secret-info" class="secret-text">---</div>
            </div>
            <div style="font-size: 14px;">å¤©è³¦ä¿åº•ï¼š<b id="display-talent" style="color:var(--accent)">--</b></div>
        </div>

        <button id="roll-btn" class="btn-roll" onclick="rollDice()">ğŸ² æ“²éª°å­</button>
        <div class="dice-display" id="dice-container"></div>
        <div class="res-summary" id="res-list">ç­‰å¾…æ“²éª°...</div>

        <h3 style="font-size: 16px; border-left: 5px solid var(--blue); padding-left: 10px; margin: 15px 0 10px 0;">äººç”Ÿå•†åº— (2è³‡æº3åˆ†å€)</h3>
        <div class="market" id="market-container"></div>
    </div>

    <div id="panel-over" class="panel" style="display:none; text-align: center;">
        <h1 style="color:var(--gold)">ğŸ† äººç”Ÿçµç®—</h1>
        <div id="final-list"></div>
        <button onclick="location.reload()" style="margin-top:20px; padding:15px 30px; background:var(--main); color:white; border:none; border-radius:10px; font-weight:bold;">é‡æ–°é–‹å§‹</button>
    </div>
</div>

<script>
    const diceFaces = [
        { n: 'äººéš›', c: '#e67e22', i: 'ğŸ¤' }, { n: 'é‡‘éŒ¢', c: '#f1c40f', i: 'ğŸ’°' },
        { n: 'æ™ºæ…§', c: '#3498db', i: 'ğŸ’¡' }, { n: 'ç¬‘è‡‰', c: '#2ecc71', i: 'ğŸ˜Š' },
        { n: 'å“­è‡‰', c: '#e74c3c', i: 'ğŸ’€' }, { n: 'å¥åº·', c: '#9b59b6', i: 'ğŸ¥' }
    ];

    const periods = ["å¹¼å¹´æœŸ", "å…¥å­¸æœŸ", "é’æ˜¥æœŸ", "åŒ—æ¼‚æœŸ", "æˆå®¶æœŸ", "å£¯å¹´æœŸ", "å±æ©ŸæœŸ", "å›ç”˜æœŸ", "éš±å±…æœŸ", "å‚³å¥‡æœŸ"];

    const fixedMarket = [
        {n:'ç¬¬ä¸€å', t:'æ™ºæ…§', q:2, scoreType:'period', tg:[periods[0], periods[1]]},
        {n:'æ ¡éšŠæ˜æ˜Ÿ', t:'å¥åº·', q:2, scoreType:'period', tg:[periods[2], periods[3]]},
        {n:'è³¼å±‹ç½®ç”¢', t:'é‡‘éŒ¢', q:2, scoreType:'period', tg:[periods[4], periods[5]]},
        {n:'é ˜è¢–åœ°ä½', t:'äººéš›', q:2, scoreType:'period', tg:[periods[6], periods[7]]},
        {n:'å‚³å¥‡æ•…äº‹', t:'æ™ºæ…§', q:2, scoreType:'period', tg:[periods[8], periods[9]]},
        
        {n:'å°ˆæ¥­è­‰ç…§', t:'æ™ºæ…§', q:2, scoreType:'fixed', val:3, tg:[]},
        {n:'è·¨åœ‹æ—…éŠ', t:'äººéš›', q:2, scoreType:'fixed', val:3, tg:[]},
        {n:'å¥èº«ç¿’æ…£', t:'å¥åº·', q:2, scoreType:'fixed', val:3, tg:[]},
        {n:'å‰µæ¥­å†’éšª', t:'é‡‘éŒ¢', q:2, scoreType:'fixed', val:3, tg:[]},
        
        {n:'æ—¥å¸¸å„²è“„', t:'é‡‘éŒ¢', q:1, scoreType:'fixed', val:1, tg:[]},
        {n:'é€±æœ«èšé¤', t:'äººéš›', q:1, scoreType:'fixed', val:1, tg:[]},
        {n:'ç¶­æŒå¥½å¿ƒæƒ…', t:'æ™ºæ…§', q:1, scoreType:'fixed', val:1, tg:[]}
    ];

    let players = [], curIdx = 0, curRound = 1, curRes = {}, lockedIndices = [], luckyDeal = null;

    function initGame() {
        let shufP = [...periods].sort(() => .5 - Math.random());
        players = Array.from({length:10}, (_, i) => ({
            id: i+1, job: ["é†«ç”Ÿ","é§­å®¢","ç•«å®¶","åµæ¢","å»šå¸«","æ©Ÿå¸«","è¾²å¤«","è©©äºº","å°éŠ","å¤ªç©ºäºº"][i],
            secret: shufP[i], talent: ['é‡‘éŒ¢','æ™ºæ…§','äººéš›','å¥åº·'][Math.floor(Math.random()*4)], score: 0
        }));
        updateUI();
    }

    function updateUI() {
        const p = players[curIdx];
        document.getElementById('round-num').innerText = curRound;
        document.getElementById('player-label').innerText = curIdx + 1;
        document.getElementById('display-job').innerText = p.job;
        document.getElementById('display-talent').innerText = p.talent;
        document.getElementById('event-banner').style.display = 'none';
        lockedIndices = []; luckyDeal = null;
        renderMarket();
    }

    function renderMarket() {
        const p = players[curIdx];
        let html = fixedMarket.map((c, idx) => {
            let displayScore = 0;
            let isMatch = false;

            if (c.scoreType === 'period') {
                isMatch = c.tg.includes(p.secret);
                displayScore = isMatch ? 5 : 1;
            } else {
                displayScore = c.val;
            }

            const isLocked = lockedIndices.includes(idx);
            return `
                <div class="card ${isMatch ? 'match-highlight' : ''} ${isLocked ? 'locked' : ''}">
                    <div class="score-tag">+${displayScore}</div>
                    <b style="font-size:13px;">${c.n}</b>
                    <div style="font-size:11px;">éœ€: ${c.q}å€‹${c.t}</div>
                    <button class="btn-buy" onclick="buyCard(${idx})" ${isLocked ? 'disabled' : ''}>è³¼è²·</button>
                </div>`;
        }).join('');

        if (luckyDeal) {
            html = `<div class="card special-deal">
                        <div class="score-tag">+3</div>
                        <b style="font-size:13px;">âœ¨ ç¬‘è‡‰é©šå–œ</b>
                        <div style="font-size:11px;">åªéœ€: 1å€‹${luckyDeal.res}</div>
                        <button class="btn-buy" onclick="buyLucky()">æ¶è³¼</button>
                    </div>` + html;
        }
        document.getElementById('market-container').innerHTML = html;
    }

    function rollDice() {
        const p = players[curIdx];
        let cries = 0, smiles = 0;
        curRes = { 'äººéš›':0, 'é‡‘éŒ¢':0, 'æ™ºæ…§':0, 'å¥åº·':0 };
        curRes[p.talent] = 1;

        let html = "";
        for(let i=0; i<4; i++) {
            let r = diceFaces[Math.floor(Math.random()*6)];
            if(r.n === 'å“­è‡‰') { cries++; html += `<div class="dice" style="background:${r.c}">ğŸ’€<br>å“­è‡‰</div>`; }
            else if(r.n === 'ç¬‘è‡‰') {
                smiles++;
                const target = ['äººéš›', 'é‡‘éŒ¢', 'æ™ºæ…§', 'å¥åº·'][Math.floor(Math.random()*4)];
                curRes[target]++;
                html += `<div class="dice" style="background:${r.c}">ğŸ˜Š<br>${target}</div>`;
            } else { curRes[r.n]++; html += `<div class="dice" style="background:${r.c}">${r.i}<br>${r.n}</div>`; }
        }
        document.getElementById('dice-container').innerHTML = html;

        if (smiles > 0) handleLuckyEvent(smiles);
        if (cries > 0) handleAccidentEvent(cries);
        
        document.getElementById('roll-btn').disabled = true;
        renderRes(); renderMarket(); checkCanAfford();
    }

    function handleLuckyEvent(count) {
        const banner = document.getElementById('event-banner');
        banner.className = 'event-good'; banner.style.display = 'block';
        if (Math.random() > 0.4) {
            const res = ['äººéš›', 'é‡‘éŒ¢', 'æ™ºæ…§', 'å¥åº·'][Math.floor(Math.random()*4)];
            curRes[res] += count;
            banner.innerText = `ğŸ˜Š å¹¸é‹ï¼ç¬‘è‡‰è®“ä½ å¤šæ‹¿äº† ${count} å€‹ã€Œ${res}ã€ï¼`;
        } else {
            const res = ['äººéš›', 'é‡‘éŒ¢', 'æ™ºæ…§', 'å¥åº·'][Math.floor(Math.random()*4)];
            luckyDeal = { res: res };
            banner.innerText = `ğŸ é©šå–œï¼æœ¬å›åˆè§£é–ã€Œ1å€‹${res}æ›3åˆ†ã€ç‰¹æƒ ï¼`;
        }
    }

    function handleAccidentEvent(count) {
        const banner = document.getElementById('event-banner');
        if (count === 1) {
            const keys = Object.keys(curRes).filter(k => curRes[k] > 0);
            if (keys.length > 0) {
                const lost = keys[Math.floor(Math.random() * keys.length)];
                curRes[lost]--;
                if(banner.style.display === 'none') {
                    banner.className = 'event-bad'; banner.style.display = 'block';
                    banner.innerText = `ğŸ’€ æ„å¤–ï¼šä½ éºå¤±äº†ä¸€å€‹ã€Œ${lost}ã€...`;
                }
            }
        } else if (count === 2) {
            lockedIndices = [0, 1, 2, 3, 4, 5, 6].sort(() => .5 - Math.random()).slice(0, 3);
            banner.className = 'event-bad'; banner.style.display = 'block';
            banner.innerText = `ğŸŒªï¸ æ„å¤–ï¼šéƒ¨åˆ†å•†åº—å•†å“æš«æ™‚å°é–ï¼`;
        } else if (count >= 3) { alert("ğŸš¨ ç½é›£ï¼šæœ¬å›åˆå¼·åˆ¶çµæŸï¼"); nextPlayer(); }
    }

    function buyCard(idx) {
        const p = players[curIdx], c = fixedMarket[idx];
        if (curRes[c.t] >= c.q) {
            curRes[c.t] -= c.q;
            let scoreGain = 0;
            if (c.scoreType === 'period') {
                scoreGain = c.tg.includes(p.secret) ? 5 : 1;
            } else {
                scoreGain = c.val;
            }
            p.score += scoreGain;
            renderRes(); renderMarket(); checkCanAfford();
        } else alert("è³‡æºä¸è¶³ï¼");
    }

    function buyLucky() {
        if (curRes[luckyDeal.res] >= 1) {
            curRes[luckyDeal.res]--;
            players[curIdx].score += 3;
            luckyDeal = null;
            renderRes(); renderMarket(); checkCanAfford();
        }
    }

    function renderRes() {
        let txt = Object.entries(curRes).filter(([k,v])=>v>0).map(([k,v])=>`${k}x${v}`).join(' / ');
        document.getElementById('res-list').innerText = "å¯ç”¨è³‡æºï¼š" + (txt || "ç„¡");
    }

    function checkCanAfford() {
        const canNormal = fixedMarket.some((c, i) => !lockedIndices.includes(i) && curRes[c.t] >= c.q);
        const canSpecial = luckyDeal && curRes[luckyDeal.res] >= 1;
        if (!canNormal && !canSpecial) {
            setTimeout(() => { alert("å·²ç„¡å¯æ“ä½œé …ï¼Œä¸‹ä¸€ä½ã€‚"); nextPlayer(); }, 1200);
        }
    }

    function nextPlayer() {
        curIdx++;
        if(curIdx >= 10) { curIdx = 0; curRound++; if(curRound > 5) return endGame(); }
        document.getElementById('roll-btn').disabled = false;
        document.getElementById('dice-container').innerHTML = "";
        document.getElementById('res-list').innerText = "ç­‰å¾…æ“²éª°...";
        updateUI();
    }

    function showSecret(show) {
        const s = document.getElementById('secret-info');
        s.style.display = show ? 'block' : 'none';
        s.innerText = players[curIdx].secret;
    }

    function endGame() {
        document.getElementById('panel-main').style.display = 'none';
        document.getElementById('panel-over').style.display = 'block';
        const sorted = [...players].sort((a,b)=>b.score - a.score);
        document.getElementById('final-list').innerHTML = sorted.map((p, i) => `
            <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                <span><b>${i+1}. ${p.job}</b></span><b>${p.score} åˆ†</b>
            </div>`).join('');
    }
    initGame();
</script>
</body>
</html>
