<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CV ä¸Šå¸æ§å°</title>
</head>
<body style="font-family:sans-serif; padding:30px; background:#f4f4f4;">
    <h1>ğŸ› ï¸ ä¸Šå¸æ§åˆ¶é¢æ¿</h1>
    <button onclick="initGame()" style="padding:20px; background:red; color:white; font-size:1.5rem; cursor:pointer;">ğŸ”¥ åˆå§‹åŒ– / é‡ç½®éŠæˆ²</button>
    <hr>
    <div id="player-ctrl"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        const config = { 
            apiKey: "AIzaSyA5x6Q2tMCR972PnHw6yzo8X1owq8n6Ppc", 
            authDomain: "life-24445.firebaseapp.com", 
            databaseURL: "https://life-24445-default-rtdb.asia-southeast1.firebasedatabase.app", 
            projectId: "life-24445" 
        };
        const app = initializeApp(config);
        const db = getDatabase(app);

        window.initGame = () => {
            if(!confirm("ç¢ºå®šè¦æ¸…ç©ºå—ï¼Ÿ")) return;
            let ps = {};
            for(let i=1; i<=10; i++) ps[i] = { id:i, active:false, name:"", tags:{'é‡‘éŒ¢':0}, extraScore:0 };
            set(ref(db, 'cv_game_state'), {
                currentRound: 1, currentTurn: 1,
                market: [1, 2, 3, 4, 5, 6],
                players: ps,
                turnAction: { hasRolled: false, dice: [] }
            }).then(()=>alert("åˆå§‹åŒ–æˆåŠŸ"));
        };

        onValue(ref(db, 'cv_game_state/players'), (s) => {
            const ps = s.val(); if(!ps) return;
            document.getElementById('player-ctrl').innerHTML = Object.values(ps).filter(p=>p.active).map(p=>`
                <div style="border:1px solid #ccc; padding:15px; margin:10px; background:white;">
                    <b>${p.name}</b> åˆ†æ•¸: ${p.extraScore||0} 
                    <button onclick="addS(${p.id}, 1)">+1</button>
                    <button onclick="addS(${p.id}, -1)">-1</button>
                </div>
            `).join('');
        });

        window.addS = (id, amt) => {
            onValue(ref(db, `cv_game_state/players/${id}/extraScore`), (s) => {
                update(ref(db, `cv_game_state/players/${id}`), { extraScore: (s.val()||0) + amt });
            }, { onlyOnce: true });
        };
    </script>
</body>
</html>
