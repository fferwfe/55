<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>CV ä¸Šå¸ä¸»æ§å°</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #eee; }
        .admin-box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .btn { padding: 10px; border: none; border-radius: 5px; cursor: pointer; color: white; margin-right: 5px; }
        .btn-danger { background: #e74c3c; }
        .btn-primary { background: #3498db; }
        .player-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; }
        .p-card { border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="admin-box">
        <h2>ğŸŒ å…¨åŸŸæ§åˆ¶</h2>
        <button class="btn btn-danger" onclick="resetGame()">ğŸ”¥ é‡ç½®å…¨é«”éŠæˆ²</button>
        <button class="btn btn-primary" onclick="nextTurn()">â© ä¸‹ä¸€å›åˆ</button>
    </div>
    <div class="admin-box">
        <h2>ğŸ‘¥ ç©å®¶ä¸Šå¸ä¿®æ­£</h2>
        <div id="admin-p-list" class="player-grid"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyA5x6Q2tMCR972PnHw6yzo8X1owq8n6Ppc", authDomain: "life-24445.firebaseapp.com", projectId: "life-24445", storageBucket: "life-24445.firebasestorage.app", messagingSenderId: "132936539069", appId: "1:132936539069:web:66224aaac8d89d3ace10d4" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const gameRef = ref(db, 'cv_game_state');

        onValue(gameRef, (snap) => {
            const data = snap.val(); if(!data) return;
            document.getElementById('admin-p-list').innerHTML = Object.values(data.players).filter(p=>p.active).map(p => `
                <div class="p-card">
                    <b>${p.name}</b> (P${p.id})<br>
                    æ‰‹å‹•åŠ åˆ†: ${p.extraScore||0} <button onclick="adj(${p.id}, 1)">+1</button><br>
                    é‡‘éŒ¢: ${p.tags.é‡‘éŒ¢||0} <button onclick="adjRes(${p.id},'é‡‘éŒ¢',1)">+</button>
                </div>
            `).join('');
        });

        window.adj = (id, d) => {
            onValue(ref(db, `cv_game_state/players/${id}/extraScore`), s => {
                update(ref(db, `cv_game_state/players/${id}`), { extraScore: (s.val()||0) + d });
            }, { onlyOnce: true });
        };
        // é€™è£¡å¯ä¾æ­¤é¡æ¨å¢åŠ æ›´å¤š adjust å‡½æ•¸...
        window.resetGame = async () => { /* é€™è£¡æ”¾å…¥ä¹‹å‰çš„ resetGame ä»£ç¢¼ */ };
    </script>
</body>
</html>
