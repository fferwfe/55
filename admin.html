<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CV ä¸Šå¸æ§å°</title>
</head>
<body style="font-family:sans-serif; padding:20px;">
    <h1>ğŸ› ï¸ ä¸Šå¸æ§åˆ¶é¢æ¿</h1>
    <button onclick="initGame()" style="padding:20px; background:red; color:white; font-weight:bold;">ğŸ”¥ åˆå§‹åŒ– / é‡ç½®éŠæˆ²</button>
    <hr>
    <div id="player-ctrl"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        const config = { apiKey: "AIzaSyA5x6Q2tMCR972PnHw6yzo8X1owq8n6Ppc", authDomain: "life-24445.firebaseapp.com", databaseURL: "https://life-24445-default-rtdb.firebaseio.com", projectId: "life-24445" };
        const app = initializeApp(config);
        const db = getDatabase(app);

        window.initGame = () => {
            if(!confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æ•¸æ“šå—ï¼Ÿ")) return;
            let players = {};
            for(let i=1; i<=10; i++) players[i] = { id:i, active:false, name:"", tags:{'é‡‘éŒ¢':0}, extraScore:0, job:"ç„¡" };
            set(ref(db, 'cv_game_state'), {
                currentRound: 1, currentTurn: 1,
                market: [0, 1, 2, 3, 4, 5],
                players: players,
                turnAction: { hasRolled: false, dice: [] }
            });
            alert("éŠæˆ²å·²åˆå§‹åŒ–ï¼");
        };

        onValue(ref(db, 'cv_game_state/players'), (s) => {
            const ps = s.val(); if(!ps) return;
            document.getElementById('player-ctrl').innerHTML = Object.values(ps).filter(p=>p.active).map(p=>`
                <div style="border:1px solid #ccc; padding:10px; margin:5px;">
                    <b>${p.name}</b> åˆ†æ•¸: ${p.extraScore||0} 
                    <button onclick="addScore(${p.id}, 1)">+1åˆ†</button>
                    <button onclick="addScore(${p.id}, -1)">-1åˆ†</button>
                </div>
            `).join('');
        });

        window.addScore = (id, amt) => {
            update(ref(db, `cv_game_state/players/${id}`), { extraScore: (Math.random()*100) }); // é€™è£¡åƒ…ç‚ºç¯„ä¾‹ï¼Œå¯¦å‹™éœ€æŠ“å–èˆŠå€¼
        };
    </script>
</body>
</html>
