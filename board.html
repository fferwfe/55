<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CV çµç®—å¤§çœ‹æ¿</title>
    <style>
        body { background: #1a1a1a; color: white; text-align: center; font-family: sans-serif; }
        .ranking { display: flex; flex-direction: column; align-items: center; }
        .item { background: #333; margin: 10px; padding: 20px; width: 80%; border-radius: 10px; display: flex; justify-content: space-between; font-size: 24px; border-left: 10px solid gold; }
    </style>
</head>
<body>
    <h1>ğŸ† å…¨çƒäººç”Ÿå±¥æ­·æˆå°±æ¦œ</h1>
    <div id="board" class="ranking"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = { databaseURL: "https://life-24445-default-rtdb.asia-southeast1.firebasedatabase.app" };
    const app = initializeApp(config);
    const db = getDatabase(app);

    // éšæ¢¯è¨ˆåˆ†é‚è¼¯
    function calc(count) {
        if (count <= 0) return 0;
        if (count <= 2) return 2;
        if (count <= 4) return 4;
        if (count <= 6) return 6;
        return 6 + (count - 6);
    }

    onValue(ref(db, 'cv_game_state/players'), (snap) => {
        const ps = snap.val(); if(!ps) return;
        const sorted = Object.values(ps).map(p => {
            let score = p.extraScore || 0;
            Object.values(p.allTags).forEach(v => score += calc(v));
            return { job: p.job, score };
        }).sort((a,b) => b.score - a.score);

        document.getElementById('board').innerHTML = sorted.map((s, i) => `
            <div class="item">
                <span>No.${i+1} ${s.job}</span>
                <span>${s.score} åˆ†</span>
            </div>
        `).join('');
    });
</script>
</body>
</html>
