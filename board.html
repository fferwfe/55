<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CV æ¦®è€€æ¦œ</title>
    <style>
        body { background: #0f0f23; color: white; text-align: center; font-family: 'PingFang TC', sans-serif; }
        .container { max-width: 800px; margin: auto; padding: 20px; }
        .rank-item { 
            background: linear-gradient(90deg, #16213e, #1a1a2e); 
            margin: 15px 0; padding: 20px; border-radius: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            border-left: 8px solid #4ecca3; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .rank-number { font-size: 2rem; font-weight: bold; color: #4ecca3; width: 50px; }
        .rank-info { flex-grow: 1; text-align: left; margin-left: 20px; }
        .rank-score { font-size: 2.5rem; font-weight: bold; color: #f1c40f; }
        .tag-summary { font-size: 0.9rem; color: #888; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="font-size: 3rem; margin-bottom: 10px;">ğŸ† ç©å®¶æˆå°±æ’è¡Œ</h1>
        <p style="color: #4ecca3;">è¨ˆåˆ†è¦å‰‡ï¼šåŒé¡æ¨™ç±¤ (1-2å€‹:2åˆ† | 3-4å€‹:4åˆ† | 5-6å€‹:6åˆ† | 7å€‹+:æ¯å¤š1å€‹+1åˆ†)</p>
        <div id="leaderboard"></div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = { databaseURL: "https://life-24445-default-rtdb.asia-southeast1.firebasedatabase.app" };
    const app = initializeApp(config);
    const db = getDatabase(app);

    function calculateScore(count) {
        if (count <= 0) return 0;
        if (count <= 2) return 2;
        if (count <= 4) return 4;
        if (count <= 6) return 6;
        return 6 + (count - 6);
    }

    onValue(ref(db, 'cv_game_state/players'), (snap) => {
        const ps = snap.val(); if(!ps) return;
        const list = Object.values(ps).map(p => {
            let total = p.extraScore || 0;
            let detail = "";
            if(p.allTags) {
                Object.entries(p.allTags).forEach(([k, v]) => {
                    total += calculateScore(v);
                    if(v > 0) detail += `${k}:${v} `;
                });
            }
            return { job: p.job, score: total, detail, active: p.active };
        }).sort((a,b) => b.score - a.score);

        document.getElementById('leaderboard').innerHTML = list.map((p, i) => `
            <div class="rank-item" style="opacity: ${p.active ? 1 : 0.5}">
                <div class="rank-number">#${i+1}</div>
                <div class="rank-info">
                    <div style="font-size: 1.5rem; font-weight: bold;">${p.job}</div>
                    <div class="tag-summary">${p.detail || 'å°šæœªç²å¾—æ¨™ç±¤'}</div>
                </div>
                <div class="rank-score">${p.score}</div>
            </div>
        `).join('');
    });
</script>
</body>
</html>
